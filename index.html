<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e40af">
    <title>BiasharaPOS</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}:root{--primary:#1e40af;--primary-dark:#1e3a8a;--success:#059669;--danger:#dc2626;--warning:#f59e0b;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-500:#6b7280;--gray-700:#374151;--gray-800:#1f2937}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--gray-100);height:100vh;overflow:hidden}.pos-container{display:grid;grid-template-columns:1fr 340px;height:100vh}@media(max-width:900px){.pos-container{grid-template-columns:1fr}.cart-panel{display:none}.cart-panel.show{display:flex;position:fixed;inset:0;z-index:1000}}.header{background:linear-gradient(135deg,var(--primary-dark),var(--primary));color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}.header h1{font-size:1.2rem}.header-shop{font-size:.8rem;opacity:.9}.header-right{display:flex;gap:8px;align-items:center}.header-time{font-size:.7rem;opacity:.8;margin-right:8px}.header-btn{background:rgba(255,255,255,.2);border:none;padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer}.cart-toggle{display:none;background:var(--success);position:relative}.cart-badge{position:absolute;top:-5px;right:-5px;background:var(--danger);font-size:.7rem;padding:2px 6px;border-radius:10px;font-weight:700}@media(max-width:900px){.cart-toggle{display:flex}}.products-panel{display:flex;flex-direction:column;height:100vh;overflow:hidden}.categories-bar{background:#fff;padding:10px 12px;display:flex;gap:8px;overflow-x:auto;border-bottom:1px solid var(--gray-200);flex-shrink:0}.cat-btn{padding:8px 16px;border:1px solid var(--gray-200);border-radius:20px;background:#fff;font-size:.8rem;font-weight:500;color:var(--gray-500);cursor:pointer;white-space:nowrap}.cat-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}.search-bar{padding:10px 12px;background:#fff;border-bottom:1px solid var(--gray-200)}.search-input{width:100%;padding:10px 14px;border:1px solid var(--gray-300);border-radius:10px;font-size:.9rem}.products-grid{flex:1;overflow-y:auto;padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px;align-content:start}.product-btn{background:#fff;border:2px solid var(--gray-200);border-radius:12px;padding:12px 8px;cursor:pointer;display:flex;flex-direction:column;align-items:center;text-align:center;transition:all .15s}.product-btn:hover{border-color:var(--primary);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1)}.product-btn.low-stock{border-color:var(--warning);background:#fffbeb}.product-btn.out-of-stock{border-color:var(--danger);background:#fef2f2;opacity:.6;pointer-events:none}.product-emoji{font-size:1.8rem;margin-bottom:4px}.product-name{font-size:.75rem;font-weight:600;color:var(--gray-700);margin-bottom:4px;line-height:1.2}.product-price{font-size:.85rem;font-weight:700;color:var(--primary)}.product-stock{font-size:.65rem;color:var(--gray-500);margin-top:2px}.product-stock.low{color:var(--warning);font-weight:600}.product-stock.out{color:var(--danger)}.cart-panel{background:#fff;border-left:1px solid var(--gray-200);display:flex;flex-direction:column;height:100vh}.cart-header{background:var(--gray-800);color:#fff;padding:14px 16px;display:flex;justify-content:space-between;align-items:center}.cart-count{background:#3b82f6;padding:2px 10px;border-radius:12px;font-size:.8rem}.cart-close{display:none;background:0 0;border:none;color:#fff;font-size:1.5rem;cursor:pointer}@media(max-width:900px){.cart-close{display:block}}.cart-items{flex:1;overflow-y:auto;padding:12px}.cart-empty{text-align:center;padding:40px 20px;color:var(--gray-500)}.cart-empty-icon{font-size:3rem;margin-bottom:10px}.cart-item{background:var(--gray-50);border-radius:10px;padding:10px 12px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}.cart-item-info{flex:1}.cart-item-name{font-size:.85rem;font-weight:600}.cart-item-price{font-size:.75rem;color:var(--gray-500)}.cart-item-controls{display:flex;align-items:center;gap:8px}.qty-btn{width:28px;height:28px;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:700}.qty-btn.minus{background:var(--gray-200);color:var(--gray-700)}.qty-btn.plus{background:var(--primary);color:#fff}.cart-item-qty{font-size:.9rem;font-weight:700;min-width:24px;text-align:center}.cart-item-total{font-size:.9rem;font-weight:700;color:var(--primary);min-width:70px;text-align:right}.cart-item-remove{background:0 0;border:none;color:var(--danger);cursor:pointer;font-size:1.1rem;padding:4px;margin-left:4px}.cart-footer{border-top:1px solid var(--gray-200);padding:12px}.cart-row{display:flex;justify-content:space-between;padding:4px 0;font-size:.85rem}.cart-row.total{font-size:1.2rem;font-weight:700;padding-top:8px;border-top:1px dashed var(--gray-300);margin-top:4px}.payment-btns{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px}.pay-btn{padding:12px 8px;border:2px solid var(--gray-200);border-radius:10px;background:#fff;cursor:pointer;font-size:.8rem;font-weight:600}.pay-btn.active{border-color:var(--success);background:#ecfdf5;color:var(--success)}.pay-btn .pay-icon{font-size:1.2rem;display:block;margin-bottom:2px}.action-btns{display:grid;grid-template-columns:1fr 2fr;gap:8px}.clear-btn{padding:14px;border:none;border-radius:10px;background:var(--gray-200);color:var(--gray-700);font-weight:600;cursor:pointer}.complete-btn{padding:14px;border:none;border-radius:10px;background:var(--success);color:#fff;font-size:1rem;font-weight:700;cursor:pointer}.complete-btn:disabled{background:var(--gray-300);cursor:not-allowed}.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:2000;padding:20px}.modal-overlay.hidden{display:none}.modal{background:#fff;border-radius:16px;width:100%;max-width:360px;max-height:90vh;overflow-y:auto}.receipt{padding:20px;font-family:'Courier New',monospace}.receipt-header{text-align:center;border-bottom:2px dashed var(--gray-300);padding-bottom:12px;margin-bottom:12px}.receipt-logo{font-size:1.2rem;font-weight:700;color:var(--primary)}.receipt-shop{font-size:.9rem;font-weight:600;margin-top:4px}.receipt-info{font-size:.75rem;color:var(--gray-500);margin-top:4px}.receipt-items{border-bottom:1px dashed var(--gray-300);padding-bottom:12px;margin-bottom:12px}.receipt-item{display:flex;justify-content:space-between;font-size:.8rem;padding:3px 0}.receipt-row{display:flex;justify-content:space-between;font-size:.85rem;padding:2px 0}.receipt-row.grand{font-size:1.1rem;font-weight:700;border-top:2px solid var(--gray-800);padding-top:8px;margin-top:4px}.receipt-footer{text-align:center;font-size:.75rem;color:var(--gray-500);border-top:2px dashed var(--gray-300);padding-top:12px}.receipt-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:16px;border-top:1px solid var(--gray-200)}.receipt-btn{padding:12px;border:none;border-radius:10px;font-weight:600;cursor:pointer}.receipt-btn.print{background:var(--primary);color:#fff}.receipt-btn.done{background:var(--success);color:#fff}.setup-modal{padding:24px}.setup-modal h2{font-size:1.2rem;margin-bottom:16px}.setup-step{background:var(--gray-50);border-radius:10px;padding:12px;margin-bottom:10px}.setup-step-title{font-weight:600;font-size:.9rem;margin-bottom:6px;display:flex;align-items:center;gap:8px}.setup-step-num{background:var(--primary);color:#fff;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700}.setup-step p{font-size:.8rem;color:var(--gray-500)}.input-group{margin-bottom:14px}.input-group label{display:block;font-size:.85rem;font-weight:500;margin-bottom:6px}.input-group input{width:100%;padding:12px;border:1px solid var(--gray-300);border-radius:10px;font-size:.9rem}.setup-btn{width:100%;padding:14px;border:none;border-radius:10px;background:var(--primary);color:#fff;font-size:1rem;font-weight:600;cursor:pointer}.demo-link{text-align:center;margin-top:12px;font-size:.85rem;color:var(--gray-500)}.demo-link a{color:var(--primary);text-decoration:none;font-weight:500}.setup-footer{margin-top:20px;padding-top:16px;border-top:1px solid var(--gray-200);text-align:center}.setup-footer p{font-size:.75rem;color:var(--gray-500);margin:2px 0}.setup-footer a{color:var(--success);text-decoration:none}.quick-modal{padding:20px}.quick-modal h3{font-size:1rem;margin-bottom:16px;text-align:center}.quick-product-name{font-size:1.1rem;font-weight:700;text-align:center;color:var(--primary);margin-bottom:4px}.quick-product-price{font-size:.9rem;text-align:center;color:var(--gray-500);margin-bottom:16px}.quick-qty-row{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:20px}.quick-qty-btn{width:50px;height:50px;border:none;border-radius:12px;font-size:1.5rem;font-weight:700;cursor:pointer}.quick-qty-btn.minus{background:var(--gray-200);color:var(--gray-700)}.quick-qty-btn.plus{background:var(--primary);color:#fff}.quick-qty-display{font-size:2rem;font-weight:700;min-width:60px;text-align:center}.quick-total{text-align:center;font-size:1.2rem;margin-bottom:16px}.quick-total span{font-weight:700;color:var(--success)}.quick-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px}.quick-btn{padding:14px;border:none;border-radius:10px;font-size:.95rem;font-weight:600;cursor:pointer}.quick-btn.cancel{background:var(--gray-200);color:var(--gray-700)}.quick-btn.add{background:var(--success);color:#fff}
    </style>
</head>
<body>
    <div class="pos-container">
        <div class="products-panel">
            <div class="header">
                <div><h1>üõí BiasharaPOS</h1><div class="header-shop" id="shopName">Loading...</div></div>
                <div class="header-right">
                    <div class="header-time" id="currentTime"></div>
                    <button class="header-btn" onclick="showSettings()">‚öôÔ∏è</button>
                    <button class="header-btn cart-toggle" onclick="toggleCart()">üõí <span class="cart-badge" id="cartBadge">0</span></button>
                </div>
            </div>
            <div class="categories-bar" id="categoriesBar"><button class="cat-btn active" onclick="filterCategory('all',this)">All</button></div>
            <div class="search-bar"><input type="text" class="search-input" id="searchInput" placeholder="üîç Search products..." oninput="filterProducts()"></div>
            <div class="products-grid" id="productsGrid"></div>
        </div>
        <div class="cart-panel" id="cartPanel">
            <div class="cart-header"><h2>üßæ Current Sale</h2><span class="cart-count" id="cartCount">0 items</span><button class="cart-close" onclick="toggleCart()">√ó</button></div>
            <div class="cart-items" id="cartItems"><div class="cart-empty"><div class="cart-empty-icon">üõí</div><p>Cart is empty</p></div></div>
            <div class="cart-footer">
                <div class="cart-summary"><div class="cart-row"><span>Subtotal</span><span id="subtotal">KES 0</span></div><div class="cart-row total"><span>TOTAL</span><span id="grandTotal">KES 0</span></div></div>
                <div class="payment-btns">
                    <button class="pay-btn active" onclick="selectPayment('Cash',this)"><span class="pay-icon">üíµ</span>Cash</button>
                    <button class="pay-btn" onclick="selectPayment('M-Pesa',this)"><span class="pay-icon">üì±</span>M-Pesa</button>
                    <button class="pay-btn" onclick="selectPayment('Credit',this)"><span class="pay-icon">üìù</span>Credit</button>
                </div>
                <div class="action-btns"><button class="clear-btn" onclick="clearCart()">Clear</button><button class="complete-btn" id="completeBtn" onclick="completeSale()" disabled>‚úì Complete</button></div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="setupModal"><div class="modal"><div class="setup-modal">
        <h2>üìä Setup BiasharaPOS</h2>
        <div class="setup-step"><div class="setup-step-title"><span class="setup-step-num">1</span>Get your data link</div><p>Contact Rudder Analytics for your inventory sheet.</p></div>
        <div class="setup-step"><div class="setup-step-title"><span class="setup-step-num">2</span>Enter details</div><p>Paste your Google Sheet link and business name.</p></div>
        <div class="input-group"><label>Google Sheet URL</label><input type="text" id="sheetInput" placeholder="Paste your data link..."></div>
        <div class="input-group"><label>Business Name</label><input type="text" id="shopInput" placeholder="e.g. Mama Njeri Supermarket"></div>
        <button class="setup-btn" onclick="saveSetup()">üöÄ Connect & Start</button>
        <p class="demo-link">Or <a href="#" onclick="loadDemo();return false;">try demo mode</a></p>
        <div class="setup-footer"><p style="font-weight:600;color:#374151">Rudder Research and Data Analytics LTD</p><p>üìû <a href="tel:+254792719505">+254 792 719 505</a></p><p>‚úâÔ∏è <a href="mailto:info@rudderdatanalytics.co.ke">info@rudderdatanalytics.co.ke</a></p></div>
    </div></div></div>
    <div class="modal-overlay hidden" id="receiptModal"><div class="modal"><div class="receipt" id="receiptContent"></div><div class="receipt-actions"><button class="receipt-btn print" onclick="printReceipt()">üñ®Ô∏è Print</button><button class="receipt-btn done" onclick="closeReceipt()">‚úì Done</button></div></div></div>
    <div class="modal-overlay hidden" id="quickModal"><div class="modal"><div class="quick-modal">
        <h3>Add to Cart</h3>
        <div class="quick-product-name" id="quickProductName"></div>
        <div class="quick-product-price" id="quickProductPrice"></div>
        <div class="quick-qty-row"><button class="quick-qty-btn minus" onclick="quickQtyChange(-1)">‚àí</button><div class="quick-qty-display" id="quickQty">1</div><button class="quick-qty-btn plus" onclick="quickQtyChange(1)">+</button></div>
        <div class="quick-total">Total: <span id="quickTotal">KES 0</span></div>
        <div class="quick-actions"><button class="quick-btn cancel" onclick="closeQuickModal()">Cancel</button><button class="quick-btn add" onclick="confirmQuickAdd()">Add to Cart</button></div>
    </div></div></div>
    <script>
        let config={pacxId:'',shopName:''},products=[],cart=[],selectedPayment='Cash',currentCategory='all',quickAddProduct=null,quickAddQty=1;
        const icons={'Maize Flour':'üåΩ','Sugar':'üç¨','Rice':'üçö','Cooking Oil':'ü´í','Milk':'ü•õ','Tea':'üçµ','Bread':'üçû','Soft Drinks':'ü•§','Water':'üíß','Soap':'üßº','Detergent':'üß¥','Eggs':'ü•ö','default':'üì¶'};
        document.addEventListener('DOMContentLoaded',()=>{updateTime();setInterval(updateTime,1000);const s=localStorage.getItem('biasharaPosConfig');if(s){config=JSON.parse(s);if(config.pacxId){document.getElementById('setupModal').classList.add('hidden');loadProducts();}}});
        function updateTime(){document.getElementById('currentTime').textContent=new Date().toLocaleString('en-KE',{weekday:'short',day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'});}
        function saveSetup(){const url=document.getElementById('sheetInput').value.trim(),name=document.getElementById('shopInput').value.trim()||'My Shop',id=extractPacxId(url);if(!id){alert('Please enter valid Google Sheet URL');return;}config={pacxId:id,shopName:name};localStorage.setItem('biasharaPosConfig',JSON.stringify(config));document.getElementById('setupModal').classList.add('hidden');loadProducts();}
        function extractPacxId(u){if(!u)return null;let m=u.match(/\/d\/e\/(2PACX-[A-Za-z0-9_-]+)/);if(m)return m[1];if(u.startsWith('2PACX-'))return u.split(/[?#\/\s]/)[0];m=u.match(/\/d\/([a-zA-Z0-9_-]+)/);return m?m[1]:null;}
        function showSettings(){document.getElementById('setupModal').classList.remove('hidden');}
        async function loadProducts(){document.getElementById('shopName').textContent=config.shopName;try{const r=await fetch(`https://docs.google.com/spreadsheets/d/e/${config.pacxId}/pub?output=csv&sheet=Inventory`);const csv=await r.text();products=parseCSV(csv).map(row=>({id:row['Product ID']||'',name:row['Product Name']||'',category:row['Category']||'',cost:parseFloat(row['Cost Price (KES)'])||0,price:parseFloat(row['Selling Price (KES)'])||0,stock:parseInt(row['Current Stock'])||0,reorder:parseInt(row['Reorder Level'])||0})).filter(p=>p.name);renderCategories();renderProducts();}catch(e){console.error(e);alert('Failed to load products');}}
        function parseCSV(csv){const lines=csv.split('\n');if(lines.length<2)return[];const headers=lines[0].split(',').map(h=>h.trim().replace(/^"|"$/g,''));return lines.slice(1).filter(l=>l.trim()).map(line=>{const vals=[];let cur='',inQ=false;for(let c of line){if(c==='"')inQ=!inQ;else if(c===','&&!inQ){vals.push(cur);cur='';}else cur+=c;}vals.push(cur);const row={};headers.forEach((h,i)=>row[h]=vals[i]?vals[i].replace(/^"|"$/g,''):'');return row;});}
        function renderCategories(){const cats=[...new Set(products.map(p=>p.category).filter(c=>c))];const bar=document.getElementById('categoriesBar');bar.innerHTML='<button class="cat-btn active" onclick="filterCategory(\'all\',this)">All</button>';cats.forEach(c=>{bar.innerHTML+=`<button class="cat-btn" onclick="filterCategory('${c}',this)">${c}</button>`;});}
        function filterCategory(c,btn){currentCategory=c;document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderProducts();}
        function renderProducts(){const search=document.getElementById('searchInput').value.toLowerCase();const filtered=products.filter(p=>(currentCategory==='all'||p.category===currentCategory)&&(!search||p.name.toLowerCase().includes(search)));document.getElementById('productsGrid').innerHTML=filtered.map(p=>{const icon=Object.entries(icons).find(([k])=>p.category.toLowerCase().includes(k.toLowerCase()))?.[1]||icons.default;const sc=p.stock===0?'out-of-stock':p.stock<=p.reorder?'low-stock':'';const st=p.stock===0?'out':p.stock<=p.reorder?'low':'';return`<button class="product-btn ${sc}" onclick="addToCart('${p.id}')" ${p.stock===0?'disabled':''}><span class="product-emoji">${icon}</span><span class="product-name">${p.name}</span><span class="product-price">KES ${p.price}</span><span class="product-stock ${st}">${p.stock===0?'Out':p.stock<=p.reorder?'Low: '+p.stock:'Stock: '+p.stock}</span></button>`;}).join('');}
        function filterProducts(){renderProducts();}
        function addToCart(id){const p=products.find(x=>x.id===id);if(!p||p.stock===0)return;quickAddProduct=p;quickAddQty=1;document.getElementById('quickProductName').textContent=p.name;document.getElementById('quickProductPrice').textContent=`KES ${p.price} each`;document.getElementById('quickQty').textContent=quickAddQty;document.getElementById('quickTotal').textContent=`KES ${p.price*quickAddQty}`;document.getElementById('quickModal').classList.remove('hidden');}
        function quickQtyChange(d){quickAddQty=Math.max(1,Math.min(quickAddQty+d,quickAddProduct.stock));document.getElementById('quickQty').textContent=quickAddQty;document.getElementById('quickTotal').textContent=`KES ${quickAddProduct.price*quickAddQty}`;}
        function confirmQuickAdd(){const ex=cart.find(i=>i.id===quickAddProduct.id);if(ex)ex.qty=Math.min(ex.qty+quickAddQty,quickAddProduct.stock);else cart.push({id:quickAddProduct.id,name:quickAddProduct.name,price:quickAddProduct.price,cost:quickAddProduct.cost,qty:quickAddQty,maxStock:quickAddProduct.stock});closeQuickModal();updateCart();}
        function closeQuickModal(){document.getElementById('quickModal').classList.add('hidden');quickAddProduct=null;}
        function updateCart(){const items=document.getElementById('cartItems'),total=cart.reduce((s,i)=>s+i.qty,0),sub=cart.reduce((s,i)=>s+i.price*i.qty,0);document.getElementById('cartCount').textContent=`${total} item${total!==1?'s':''}`;document.getElementById('cartBadge').textContent=total;document.getElementById('subtotal').textContent=`KES ${sub.toLocaleString()}`;document.getElementById('grandTotal').textContent=`KES ${sub.toLocaleString()}`;document.getElementById('completeBtn').disabled=cart.length===0;if(cart.length===0){items.innerHTML='<div class="cart-empty"><div class="cart-empty-icon">üõí</div><p>Cart is empty</p></div>';return;}items.innerHTML=cart.map(i=>`<div class="cart-item"><div class="cart-item-info"><div class="cart-item-name">${i.name}</div><div class="cart-item-price">KES ${i.price} each</div></div><div class="cart-item-controls"><button class="qty-btn minus" onclick="changeQty('${i.id}',-1)">‚àí</button><span class="cart-item-qty">${i.qty}</span><button class="qty-btn plus" onclick="changeQty('${i.id}',1)">+</button></div><div class="cart-item-total">KES ${(i.price*i.qty).toLocaleString()}</div><button class="cart-item-remove" onclick="removeFromCart('${i.id}')">üóëÔ∏è</button></div>`).join('');}
        function changeQty(id,d){const i=cart.find(x=>x.id===id);if(i){i.qty=Math.max(1,Math.min(i.qty+d,i.maxStock));updateCart();}}
        function removeFromCart(id){cart=cart.filter(i=>i.id!==id);updateCart();}
        function clearCart(){if(cart.length&&!confirm('Clear cart?'))return;cart=[];updateCart();}
        function selectPayment(m,btn){selectedPayment=m;document.querySelectorAll('.pay-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
        function toggleCart(){document.getElementById('cartPanel').classList.toggle('show');}
        function completeSale(){if(!cart.length)return;const t=new Date(),id='S'+t.getTime().toString(36).toUpperCase(),sub=cart.reduce((s,i)=>s+i.price*i.qty,0);document.getElementById('receiptContent').innerHTML=`<div class="receipt-header"><div class="receipt-logo">üõí BiasharaPOS</div><div class="receipt-shop">${config.shopName}</div><div class="receipt-info">${t.toLocaleString('en-KE')}</div><div class="receipt-info">Receipt: ${id}</div></div><div class="receipt-items">${cart.map(i=>`<div class="receipt-item"><span>${i.name}</span><span>x${i.qty}</span><span>KES ${(i.price*i.qty).toLocaleString()}</span></div>`).join('')}</div><div class="receipt-totals"><div class="receipt-row"><span>Subtotal</span><span>KES ${sub.toLocaleString()}</span></div><div class="receipt-row"><span>Payment</span><span>${selectedPayment}</span></div><div class="receipt-row grand"><span>TOTAL</span><span>KES ${sub.toLocaleString()}</span></div></div><div class="receipt-footer"><p>Thank you!</p><p>Powered by BiasharaPOS</p><p>Rudder Research & Data Analytics</p></div>`;document.getElementById('receiptModal').classList.remove('hidden');cart.forEach(i=>{const p=products.find(x=>x.id===i.id);if(p)p.stock-=i.qty;});cart=[];updateCart();renderProducts();}
        function printReceipt(){const w=window.open('','','width=300,height=600');w.document.write('<html><head><style>body{font-family:Courier New,monospace;font-size:12px;padding:10px}.receipt-header{text-align:center;border-bottom:2px dashed #000;padding-bottom:10px;margin-bottom:10px}.receipt-logo{font-size:16px;font-weight:bold}.receipt-item{display:flex;justify-content:space-between;padding:2px 0}.receipt-row{display:flex;justify-content:space-between}.receipt-row.grand{font-weight:bold;border-top:2px solid #000;padding-top:5px;margin-top:5px}.receipt-footer{text-align:center;border-top:2px dashed #000;padding-top:10px;margin-top:10px}</style></head><body>'+document.getElementById('receiptContent').innerHTML+'</body></html>');w.document.close();w.print();}
        function closeReceipt(){document.getElementById('receiptModal').classList.add('hidden');}
        function loadDemo(){config={pacxId:'demo',shopName:'Demo Supermarket - Nairobi'};localStorage.setItem('biasharaPosConfig',JSON.stringify(config));products=[{id:'MF001',category:'Maize Flour',name:'Jogoo 2kg',cost:165,price:185,stock:50,reorder:20},{id:'MF002',category:'Maize Flour',name:'Pembe 2kg',cost:158,price:175,stock:8,reorder:15},{id:'SG001',category:'Sugar',name:'Mumias 1kg',cost:145,price:165,stock:60,reorder:25},{id:'SG002',category:'Sugar',name:'Kabras 1kg',cost:142,price:162,stock:5,reorder:20},{id:'RC001',category:'Rice',name:'Pishori 1kg',cost:180,price:220,stock:40,reorder:15},{id:'RC002',category:'Rice',name:'Sindano 1kg',cost:120,price:150,stock:0,reorder:15},{id:'OL001',category:'Cooking Oil',name:'Elianto 1L',cost:280,price:320,stock:35,reorder:15},{id:'OL002',category:'Cooking Oil',name:'Kimbo 500g',cost:180,price:210,stock:7,reorder:15},{id:'ML001',category:'Milk',name:'Brookside 500ml',cost:55,price:70,stock:50,reorder:30},{id:'TE001',category:'Tea',name:'Ketepa 100g',cost:110,price:140,stock:40,reorder:20},{id:'SD001',category:'Soft Drinks',name:'Coca Cola 500ml',cost:60,price:80,stock:48,reorder:24},{id:'SD002',category:'Soft Drinks',name:'Fanta 500ml',cost:58,price:75,stock:36,reorder:20},{id:'WA001',category:'Water',name:'Keringet 500ml',cost:25,price:40,stock:60,reorder:30},{id:'BR001',category:'Bread',name:'Supa Loaf 400g',cost:52,price:65,stock:20,reorder:10},{id:'SP001',category:'Soap',name:'Jamaa Bar',cost:45,price:60,stock:100,reorder:30},{id:'DT001',category:'Detergent',name:'Omo 500g',cost:120,price:150,stock:3,reorder:10},{id:'EG001',category:'Eggs',name:'Eggs Tray 30',cost:400,price:480,stock:15,reorder:5}];document.getElementById('setupModal').classList.add('hidden');document.getElementById('shopName').textContent=config.shopName;renderCategories();renderProducts();}
    </script>
</body>
</html>
